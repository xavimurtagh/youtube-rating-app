// This file was auto-generated by Prisma! Do not edit it manually.
// Find out more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(uuid())
  email          String   @unique
  name           String
  avatar         String?          // URL
  bio            String?          @db.VarChar(280)
  passwordHash   String           // if you keep email-password

  favourites     Video[] @relation("Favourites")
  ratings        Rating[]
  followers      Follow[] @relation("Followee")
  following      Follow[] @relation("Follower")
  activities     Activity[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Video {
  id            String   @id                      // youtubeId
  title         String
  channel       String
  thumbnail     String?
  isMusic       Boolean   @default(false)

  favourites    User[]    @relation("Favourites")
  ratings       Rating[]
}

model Rating {
  id        String   @id @default(uuid())
  user      User     @relation(fields:[userId], references:[id])
  userId    String
  video     Video    @relation(fields:[videoId], references:[id])
  videoId   String
  score     Int      // 1-10
  ratedAt   DateTime @default(now())

  @@unique([userId, videoId])
}

model Follow {
  id          String   @id @default(uuid())
  follower    User     @relation("Follower", fields:[followerId], references:[id])
  followerId  String
  followee    User     @relation("Followee", fields:[followeeId], references:[id])
  followeeId  String
  createdAt   DateTime @default(now())

  @@unique([followerId, followeeId])
}

model Activity {
  id        String   @id @default(uuid())
  user      User     @relation(fields:[userId], references:[id])
  userId    String
  type      String               // "rating" | "favourite"
  videoId   String
  data      Json?
  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}
